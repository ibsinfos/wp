/**
 * Dynamic Stock Charts (jQuery plugin)
 * Version 1.2.0, built on Mon Apr 25 2016
 * Copyright WebTheGap <mail@webthegap.com>
 * http://webthegap.com/widgets/dynamic-stock-charts/
 */
$(document).ready(function(){function t(t){return'<div id="chart-'+t.data("symbol")+"-"+t.data("type")+'" class="dschart" data-symbol="'+t.data("symbol")+'" data-type="'+t.data("type")+'" data-start-date="'+t.data("start-date")+'" data-end-date="'+t.data("end-date")+"\" data-chart-options='"+JSON.stringify(t.data("chart-options"))+"' data-field=\""+t.data("field")+'" data-zoom="'+t.data("zoom")+'" data-navigation="'+t.data("navigation")+'" data-navigation-days="'+t.data("navigation-days")+"\" data-navigation-options='"+JSON.stringify(t.data("navigation-options"))+"' data-width=\""+t.data("width")+'" data-height="'+t.data("height")+"\" data-indicators='"+JSON.stringify(t.data("indicators"))+"'></div>"}function e(t){var e=$(".symbol-search-dropdown");if(t){var i=document.createElement("script");i.src=(window.autocomplete_path?window.autocomplete_path:"autocomplete.php")+"?url="+encodeURIComponent("https://s.yimg.com/aq/autoc?query="+t+"&region=US&lang=en-US&callback=displaySearchResults"),document.documentElement.insertBefore(i,document.documentElement.lastChild),document.documentElement.removeChild(i)}else e.empty(),e.hide();displaySearchResults=function(t){if(e.empty(),"undefined"!=typeof t.ResultSet.Result&&t.ResultSet.Result.length>0){var i=t.ResultSet.Result,a=new RegExp("("+t.ResultSet.Query+")","gi");for(var o in i){var n="<span>"+(i[o].symbol+" "+i[o].name).replace(a,"<strong>$1</strong>")+"</span>",r='<span class="symbol-type">'+i[o].typeDisp+"</span>",l='<span class="symbol-exchange">'+i[o].exchDisp+"</span>";e.append('<div class="symbol-search-dropdown-item" data-symbol="'+i[o].symbol+'">'+n+r+l+"</div>")}e.show()}}}$(".ui.checkbox").checkbox(),$("select.dropdown").dropdown(),$("#i-show-html").on("click",function(){$(".ui.modal").modal("show")}),$("#i-falling-color").spectrum({color:"#f00"}),$("#i-falling-border-color").spectrum({color:"#A10000"}),$("#i-rising-color").spectrum({color:"#13D420"}),$("#i-rising-border-color").spectrum({color:"#125C06"}),$("#i-container-background").spectrum({color:"#fff"}),$("#i-chart-background").spectrum({color:"#fff"}),$("#i-title-color").spectrum({color:"#940101"}),$("#i-x-title-color").spectrum({color:"#082278"}),$("#i-y-title-color").spectrum({color:"#082278"}),$("#i-color").spectrum({color:"#7DBEE7"}),$("#i-grid-color").spectrum({color:"#D1D1D1"}),$("#i-indicator-color").spectrum({color:"#C5C"}),$("#i-start-date, #i-end-date").datepicker({changeMonth:!1,changeYear:!1,numberOfMonths:3,dateFormat:"yy-mm-dd",onClose:function(t){"i-start-date"==this.id?$("#i-end-date").datepicker("option","minDate",t):$("#i-start-date").datepicker("option","maxDate",t)},beforeShow:function(t,e){var i=$(t).offset(),a=$(t).height();window.setTimeout(function(){e.dpDiv.css({top:i.top+a+30+"px",left:i.left+"px"})},1)}}),$("#i-type").on("change",function(){var t=$(this).val();"CandlestickChart"==t?($(".chart-type-options").hide(),$("#candlestick-options").fadeIn()):"LineChart"!=t&&"AreaChart"!=t||($(".chart-type-options").hide(),$("#line-options").fadeIn())}),$("#navigation-chart-checkbox").on("click",function(){var t=$(this).hasClass("checked");t?$("#navigation-options").fadeIn():$("#navigation-options").fadeOut()}),$("#i-indicator-type").on("change",function(){var t=$(this).val();-1!==$.inArray(t,["simpleMovingAverage","exponentialMovingAverage","weightedMovingAverage"])&&$(".indicator-settings").fadeIn()}),$("#b-add-indicator").on("click",function(t){t.preventDefault();var e,i,a=$("#i-indicator-type"),o=a.val(),n=a.find("option:selected").text();if(o){if(-1!==$.inArray(o,["simpleMovingAverage","exponentialMovingAverage","weightedMovingAverage"])){var r=parseInt($("#i-indicator-num-of-days").val());r=r>0?r:10;var l=$("#i-indicator-color").spectrum("get").toHexString();i=n+" ("+r+")",e={type:o,title:i,numberOfDays:r,color:l}}$("#indicators-container").append('<div class="ui large label"><input type="hidden" class="i-indicator" data-type="'+o+"\" data-params='"+JSON.stringify(e)+'\' value="">'+i+'<i class="delete icon b-remove-indicator"></i></div>')}}),$("#indicators-container").on("click",".b-remove-indicator",function(){$(this).parent().remove()}),$("#b-build-chart").on("click",function(e){e.preventDefault(),$("#i-show-html").hide(),$("#f-error-msg").hide(),$("#f-error-msg p").remove();var i=$("#i-stock-symbol").val(),a=$("#i-start-date").val(),o="";if(i||(o+="<p>Please input Stock Symbol</p>"),a||(o+="<p>Please input Start Date</p>"),o)return $("#f-error-msg").append(o),$("#f-error-msg").fadeIn(),!1;var n=$("#i-end-date").val(),r=$("#i-width").val(),l=$("#i-height").val(),c=$("#i-type").val(),s=$("#i-title").val(),d=$("#i-x-title").val(),p=$("#i-y-title").val(),g=$("#i-title-color").spectrum("get").toHexString(),h=$("#i-x-title-color").spectrum("get").toHexString(),m=$("#i-y-title-color").spectrum("get").toHexString(),u=$("#i-title-font-size").val(),v=$("#i-x-title-font-size").val(),f=$("#i-y-title-font-size").val(),y=$("#i-falling-color").spectrum("get").toHexString(),b=$("#i-falling-border-color").spectrum("get").toHexString(),x=$("#i-falling-border-width").val(),S=$("#i-rising-color").spectrum("get").toHexString(),k=$("#i-rising-border-color").spectrum("get").toHexString(),w=$("#i-rising-border-width").val(),C=$("#i-line-data-field").val(),A=$("#i-color").spectrum("get").toHexString(),D=$("#i-grid-color").spectrum("get").toHexString(),z=$("#i-container-background").spectrum("get").toHexString(),H=$("#i-chart-background").spectrum("get").toHexString(),R=$("#i-zoom").parent().hasClass("checked"),I=$("#i-navigation-chart").parent().hasClass("checked"),O=$("#i-navigation-type").val(),M=$("#i-navigation-days").val(),T={},E={legend:"none",title:s,titleTextStyle:{color:g,fontSize:u?u:12},tooltip:{isHtml:!0},areaOpacity:.3,aggregationTarget:"auto",backgroundColor:z,colors:[A],candlestick:{fallingColor:{stroke:b,strokeWidth:x?x:1,fill:y},risingColor:{stroke:k,strokeWidth:w?w:1,fill:S}},chartArea:{width:"80%",backgroundColor:{fill:H}},fontSize:12,hAxis:{title:d,titleTextStyle:{color:h,fontSize:v?v:12},textStyle:{color:h},gridlines:{color:D}},vAxis:{title:p,titleTextStyle:{color:m,fontSize:f?f:12},textStyle:{color:m},format:"decimal",gridlines:{color:D}}};if(R&&(E.explorer={axis:"horizontal",zoomDelta:1.2}),I){var J="CandlestickChart"==c?[0,3]:[0,1];T={filterColumnIndex:0,ui:{chartType:O?O:"LineChart",chartOptions:{chartArea:{width:"80%",height:"100%"},hAxis:{baselineColor:"none"},vAxis:{baselineColor:"none"}},chartView:{columns:J},minRangeSize:864e5}}}var N=[];$(".i-indicator").each(function(t,e){var i=$(e);N.push(i.data("params"))});var B=$("#custom-stock-chart");B.data("symbol",i),B.data("start-date",a),B.data("end-date",n),B.data("type",c?c:"CandlestickChart"),B.data("zoom",R),B.data("navigation",I),B.data("navigation-days",M?M:30),B.data("navigation-options",T),B.data("chart-options",E),B.data("width",r),B.data("height",l?l:500),B.data("field",C?C:"Close"),B.data("indicators",N),dscBuildChart(B[0]),$("#snippet").text(t(B)),setTimeout(function(){$("#i-show-html").fadeIn()},1500)}),$("#i-stock-symbol").bind("keyup",function(){$this=$(this),setTimeout(function(){e($this.val())},200)}),$(".symbol-search-dropdown").on("click",".symbol-search-dropdown-item",function(){var t=$(this);$("#i-stock-symbol").val(t.data("symbol")),t.parent().hide()})});